{% extends "base.html" %}

{% block title %}Painel de Controlo - AgroTech Portugal{% endblock %}

{% block content %}
<div class="container mx-auto px-2 sm:px-4 py-4 sm:py-6">
    <!-- Skeleton para Hero Section (desaparece quando o conteúdo carrega) -->
    <div class="skeleton-loader mb-8 rounded-lg h-56 sm:h-64"></div>
    
    <!-- Hero Section Português -->
    <div class="hero-section-portugal mb-6 sm:mb-8 animate-slide-up">
        <div class="bg-gradient-to-r from-verde-agricultura to-verde-oliveira rounded-xl p-4 sm:p-6 md:p-8 text-white shadow-lg">
            <div class="flex flex-col lg:flex-row items-center justify-between">
                <div class="lg:w-2/3 mb-6 lg:mb-0">
                    <h1 class="text-responsive-xl sm:text-responsive-2xl font-bold mb-2 sm:mb-4">
                        Bem-vindo ao AgroTech Portugal
                    </h1>
                    <p class="text-responsive-sm sm:text-responsive-base opacity-90 mb-4 sm:mb-6">
                        Plataforma digital especializada para a agricultura familiar portuguesa. 
                        Integração oficial com IPMA e conformidade com o Estatuto da Agricultura Familiar.
                    </p>
                    <div class="flex flex-wrap gap-2 sm:gap-4">
                        <a href="/gestao/culturas" class="btn-touch bg-white text-verde-agricultura hover:bg-gray-100 shadow-md">
                            <i class="fas fa-seedling mr-2"></i>
                            <span class="text-responsive-sm">Gerir Culturas</span>
                        </a>
                        <a href="/clima/previsao" class="btn-touch border border-white text-white hover:bg-white hover:text-verde-agricultura">
                            <i class="fas fa-cloud-sun mr-2"></i>
                            <span class="text-responsive-sm">Ver Previsão</span>
                        </a>
                    </div>
                </div>
                <div class="w-full lg:w-1/3 text-center mt-6 lg:mt-0">
                    <div class="bg-white bg-opacity-20 backdrop-filter backdrop-blur-sm rounded-xl p-4 sm:p-6 shadow-inner transform transition-transform hover:scale-105">
                        <div class="flex items-center justify-center w-16 h-16 mx-auto rounded-full bg-white bg-opacity-30 mb-3">
                            <i class="fas fa-certificate text-3xl text-white"></i>
                        </div>
                        <h3 class="font-semibold mb-1 text-responsive-base">Certificado IPMA</h3>
                        <p class="text-xs sm:text-sm opacity-90">Dados meteorológicos oficiais</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Métricas Principais -->
    <div class="grid-mobile mb-6 sm:mb-8 gap-3 sm:gap-4 animate-fade-in">
        <!-- Card Culturas -->
        <div class="card-mobile bg-white shadow-sm hover:shadow rounded-xl overflow-hidden border-l-4 border-verde-agricultura will-change-transform">
            <div class="flex items-center justify-between p-4 sm:p-5">
                <div class="flex items-center">
                    <div class="rounded-lg bg-green-50 p-3 mr-4">
                        <i class="fas fa-seedling text-verde-agricultura text-xl"></i>
                    </div>
                    <div>
                        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Culturas Ativas</div>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ culturas_ativas or 1 }}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">
                                <i class="fas fa-arrow-up text-xs mr-1"></i>
                                <span>Saudáveis</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="hidden sm:block">
                    <a href="/gestao/culturas" class="text-verde-agricultura hover:text-verde-oliveira">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 text-xs text-gray-600">
                <span class="inline-block mr-3"><i class="fas fa-leaf mr-1"></i>Oliveiras</span>
                <span class="inline-block mr-3"><i class="fas fa-wine-glass-alt mr-1"></i>Vinhas</span>
                <span class="inline-block"><i class="fas fa-carrot mr-1"></i>Hortícolas</span>
            </div>
        </div>

        <!-- Card Área Total -->
        <div class="card-mobile bg-white shadow-sm hover:shadow rounded-xl overflow-hidden border-l-4 border-azul-oceano will-change-transform">
            <div class="flex items-center justify-between p-4 sm:p-5">
                <div class="flex items-center">
                    <div class="rounded-lg bg-blue-50 p-3 mr-4">
                        <i class="fas fa-map text-azul-oceano text-xl"></i>
                    </div>
                    <div>
                        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Área Total</div>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ area_total or '1.0' }}m²</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                                <i class="fas fa-check text-xs mr-1"></i>
                                <span>Verificado</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="hidden sm:block">
                    <a href="/propriedades" class="text-azul-oceano hover:text-blue-700">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 text-xs text-gray-600">
                <span><i class="fas fa-map-marker-alt mr-1"></i>Registado no SIGPAC</span>
            </div>
        </div>

        <!-- Card Receita -->
        <div class="card-mobile bg-white shadow-sm hover:shadow rounded-xl overflow-hidden border-l-4 border-dourado-tradicional will-change-transform">
            <div class="flex items-center justify-between p-4 sm:p-5">
                <div class="flex items-center">
                    <div class="rounded-lg bg-yellow-50 p-3 mr-4">
                        <i class="fas fa-euro-sign text-dourado-tradicional text-xl"></i>
                    </div>
                    <div>
                        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Receita Prevista</div>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">€{{ receita_prevista or '0' }}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800">
                                <i class="fas fa-chart-line text-xs mr-1"></i>
                                <span>Estimativa</span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="hidden sm:block">
                    <a href="/financeiro" class="text-dourado-tradicional hover:text-yellow-600">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 text-xs text-gray-600">
                <span><i class="fas fa-calendar mr-1"></i>Estimativa anual</span>
            </div>
        </div>

        <!-- Card Tarefas -->
        <div class="card-mobile bg-white shadow-sm hover:shadow rounded-xl overflow-hidden border-l-4 border-vermelho-vinho will-change-transform">
            <div class="flex items-center justify-between p-4 sm:p-5">
                <div class="flex items-center">
                    <div class="rounded-lg bg-red-50 p-3 mr-4">
                        <i class="fas fa-tasks text-vermelho-vinho text-xl"></i>
                    </div>
                    <div>
                        <div class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Tarefas Pendentes</div>
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-900 mr-2">{{ tarefas_pendentes or 0 }}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-800">
                                <i class="fas fa-clock text-xs mr-1"></i>
                                <span>Próximos 7 dias</span>
                            </span>
                        </div>
                </div>
                <div class="hidden sm:block">
                    <a href="/tarefas" class="text-vermelho-vinho hover:text-red-700">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 text-xs text-gray-600 flex justify-between items-center">
                <span><i class="fas fa-calendar-check mr-1"></i>Próxima: Rega (hoje)</span>
                <button class="text-vermelho-vinho hover:underline">Ver todas</button>
            </div>
        </div>
    </div>

    <!-- Previsão do tempo e alertas -->
    <div class="flex flex-col lg:flex-row gap-4 mb-6 sm:mb-8">
        <!-- Previsão do tempo -->
        <div class="lg:w-2/3">
            <div class="card-mobile bg-white rounded-xl shadow-sm p-4 sm:p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-responsive-lg font-semibold flex items-center">
                        <i class="fas fa-cloud-sun text-dourado-tradicional mr-2"></i>
                        Previsão IPMA
                    </h2>
                    <button class="btn-touch bg-green-50 hover:bg-green-100 text-verde-agricultura rounded-full w-10 h-10 flex items-center justify-center">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>

                <!-- Versão Mobile da Previsão -->
                <div class="overflow-x-auto no-scrollbar pb-2">
                    <div class="flex space-x-4">
                        {% for i in range(5) %}
                        <div class="weather-day-mobile flex-shrink-0 w-24 text-center bg-blue-50 rounded-lg p-3">
                            <div class="text-xs font-medium mb-1">{{ (hoje + i)|default('Hoje') }}</div>
                            <div class="text-center mb-1">
                                <i class="fas fa-sun text-2xl text-dourado-tradicional"></i>
                            </div>
                            <div class="text-lg font-bold">{{ 18 + i }}°C</div>
                            <div class="text-xs">Céu limpo</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Alertas Meteorológicos -->
        <div class="lg:w-1/3">
            <div class="card-mobile bg-white rounded-xl shadow-sm p-4 sm:p-6 h-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-responsive-lg font-semibold flex items-center">
                        <i class="fas fa-exclamation-triangle text-vermelho-vinho mr-2"></i>
                        Alertas
                    </h2>
                    <span class="badge-atencao">2 novos</span>
                </div>
                
                <div class="space-y-3">
                    <div class="alert-item flex items-start p-2 rounded-lg bg-yellow-50 border-l-4 border-yellow-400">
                        <div class="mr-3 mt-1">
                            <i class="fas fa-thermometer-high text-yellow-500"></i>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium">Temperatura alta</h4>
                            <p class="text-xs text-gray-600">Aumente a rega das suas culturas</p>
                        </div>
                    </div>
                    
                    <div class="alert-item flex items-start p-2 rounded-lg bg-blue-50 border-l-4 border-blue-400">
                        <div class="mr-3 mt-1">
                            <i class="fas fa-cloud-rain text-blue-500"></i>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium">Chuva prevista</h4>
                            <p class="text-xs text-gray-600">Amanhã • 15mm previstos</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid Principal -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
        <!-- Coluna Esquerda -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Alertas Agrícolas -->
            <div class="alerts-section card-portugal">
                <div class="alerts-header">
                    <h2 class="alerts-title h3-portugal">
                        <i class="fas fa-bell text-dourado-tradicional mr-3"></i>
                        Alertas Agrícolas
                    </h2>
                    <span class="alerts-count">{{ alertas_count or 1 }} não lidos</span>
                </div>
                
                <div class="space-y-4">
                    <div class="alert-item">
                        <div class="alert-content">
                            <div class="alert-title">
                                <i class="fas fa-seedling text-verde-oliveira mr-2"></i>
                                Oportunidades de Plantio - Agosto
                            </div>
                            <div class="alert-message">
                                Este é o mês ideal para plantar: Cenoura. 
                                Aproveite as condições favoráveis de Agosto para começar novas culturas!
                            </div>
                            <div class="alert-time">10/08, 21:07</div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/alertas" class="text-verde-agricultura hover:underline font-medium">
                        Ver todos os alertas
                    </a>
                    <span class="mx-2">•</span>
                    <button class="text-gray-500 hover:text-gray-700">
                        Marcar todos como lidos
                    </button>
                </div>
            </div>

            <!-- Culturas Ativas -->
            <div class="cultures-section card-portugal">
                <div class="cultures-header">
                    <h2 class="cultures-title h3-portugal">
                        <i class="fas fa-seedling text-verde-oliveira mr-3"></i>
                        Culturas Ativas
                    </h2>
                    <a href="/gestao/culturas/nova" class="btn-new-culture">
                        <i class="fas fa-plus mr-2"></i>
                        Nova Cultura
                    </a>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Exemplo de cultura -->
                    <div class="culture-card bg-gray-50 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-verde-agricultura">
                                <i class="fas fa-seedling mr-2"></i>
                                Oliveiras
                            </h3>
                            <span class="badge-sucesso">Ativa</span>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Área:</span>
                                <span class="font-medium">0.5 hectares</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Plantio:</span>
                                <span class="font-medium">Março 2023</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Próxima tarefa:</span>
                                <span class="font-medium text-dourado-tradicional">Poda (Set)</span>
                            </div>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <a href="/culturas/1" class="btn-sm-pt btn-primary-pt flex-1 text-center">
                                Ver Detalhes
                            </a>
                            <button class="btn-sm-pt btn-outline-pt">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-6">
                    <a href="/gestao/culturas" class="text-verde-agricultura hover:underline font-medium">
                        Ver todas as culturas
                    </a>
                </div>
            </div>
        </div>

        <!-- Coluna Direita -->
        <div class="space-y-6">
            <!-- Widget Clima IPMA -->
            <div class="weather-widget card-clima">
                <div class="weather-header">
                    <h3 class="weather-title">
                        <i class="fas fa-cloud-sun mr-2"></i>
                        Clima
                    </h3>
                    <div class="flex items-center">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3E%3Ctext x='10' y='15' text-anchor='middle' fill='white' font-size='12'%3EIPMA%3C/text%3E%3C/svg%3E" alt="IPMA" class="mr-1">
                        <span class="text-xs opacity-75">Oficial</span>
                    </div>
                </div>
                
                <div class="weather-main">
                    <div class="weather-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="weather-temp">21°C</div>
                    <div class="weather-location">Serta, Portugal</div>
                    <div class="weather-feels">Sensação térmica 21°C</div>
                </div>
                
                <div class="weather-details">
                    <div class="weather-detail">
                        <span><i class="fas fa-tint mr-1"></i>Umidade:</span>
                        <span>55%</span>
                    </div>
                    <div class="weather-detail">
                        <span><i class="fas fa-wind mr-1"></i>Vento:</span>
                        <span>2.56 m/s</span>
                    </div>
                    <div class="weather-detail">
                        <span><i class="fas fa-thermometer mr-1"></i>Pressão:</span>
                        <span>1019 hPa</span>
                    </div>
                    <div class="weather-detail">
                        <span><i class="fas fa-eye mr-1"></i>Visibilidade:</span>
                        <span>10.0 km</span>
                    </div>
                </div>
                
                <div class="weather-updated">
                    Atualizado: 10/08/2025, 21:39
                </div>
            </div>

            <!-- Previsão dos Próximos Dias -->
            <div class="forecast-section card-portugal">
                <h3 class="forecast-title">
                    <i class="fas fa-calendar-alt text-azul-oceano mr-2"></i>
                    Previsão dos Próximos Dias
                </h3>
                
                <div class="space-y-3">
                    <div class="forecast-item">
                        <div class="forecast-day font-medium">Hoje</div>
                        <div class="forecast-weather">
                            <i class="fas fa-sun text-dourado-tradicional"></i>
                            <span class="forecast-temp">21°</span>
                        </div>
                    </div>
                    <div class="forecast-item">
                        <div class="forecast-day">Amanhã</div>
                        <div class="forecast-weather">
                            <i class="fas fa-cloud-sun text-azul-oceano"></i>
                            <span class="forecast-temp">26°</span>
                        </div>
                    </div>
                    <div class="forecast-item">
                        <div class="forecast-day">Quarta</div>
                        <div class="forecast-weather">
                            <i class="fas fa-cloud-sun text-azul-oceano"></i>
                            <span class="forecast-temp">23°</span>
                        </div>
                    </div>
                    <div class="forecast-item">
                        <div class="forecast-day">Quinta</div>
                        <div class="forecast-weather">
                            <i class="fas fa-sun text-dourado-tradicional"></i>
                            <span class="forecast-temp">21°</span>
                        </div>
                    </div>
                    <div class="forecast-item">
                        <div class="forecast-day">Sexta</div>
                        <div class="forecast-weather">
                            <i class="fas fa-sun text-dourado-tradicional"></i>
                            <span class="forecast-temp">25°</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/clima/previsao" class="text-azul-oceano hover:underline font-medium">
                        Ver previsão completa
                    </a>
                </div>
            </div>

            <!-- Próximas Tarefas -->
            <div class="tasks-section card-portugal">
                <div class="tasks-header">
                    <h3 class="tasks-title">
                        <i class="fas fa-tasks text-castanho-terra mr-2"></i>
                        Próximas Tarefas
                    </h3>
                    <a href="/tarefas" class="tasks-link">Ver todas</a>
                </div>
                
                <div class="no-tasks">
                    <i class="fas fa-check-circle text-verde-agricultura text-3xl mb-3"></i>
                    <p class="font-medium mb-2">Nenhuma tarefa pendente</p>
                    <p class="text-sm">Todas as tarefas estão em dia!</p>
                </div>
            </div>

            <!-- Links Rápidos -->
            <div class="card-portugal">
                <div class="card-header-pt">
                    <h3 class="h4-portugal">
                        <i class="fas fa-external-link-alt text-azul-oceano mr-2"></i>
                        Links Úteis
                    </h3>
                </div>
                <div class="card-body-pt">
                    <div class="space-y-3">
                        <a href="https://www.ipma.pt" target="_blank" 
                           class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-cloud text-azul-oceano mr-3"></i>
                            <div>
                                <div class="font-medium">IPMA</div>
                                <div class="text-sm text-gray-600">Instituto Português do Mar e da Atmosfera</div>
                            </div>
                        </a>
                        <a href="https://www.iniav.pt" target="_blank" 
                           class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-seedling text-verde-agricultura mr-3"></i>
                            <div>
                                <div class="font-medium">INIAV</div>
                                <div class="text-sm text-gray-600">Instituto Nacional de Investigação Agrária</div>
                            </div>
                        </a>
                        <a href="https://www.dgav.pt" target="_blank" 
                           class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="fas fa-shield-alt text-verde-oliveira mr-3"></i>
                            <div>
                                <div class="font-medium">DGAV</div>
                                <div class="text-sm text-gray-600">Direção-Geral de Alimentação e Veterinária</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts específicos do dashboard -->
<script nonce="{{ g.csp_nonce if g.csp_nonce else 'default' }}">
document.addEventListener('DOMContentLoaded', function() {
    // Animações de entrada
    const cards = document.querySelectorAll('.metric-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.6s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }, index * 100);
    });
    
    // Atualização automática do clima (simulada)
    setInterval(() => {
        const temp = document.querySelector('.weather-temp');
        if (temp) {
            const currentTemp = parseInt(temp.textContent);
            const variation = Math.random() > 0.5 ? 1 : -1;
            const newTemp = currentTemp + variation;
            temp.textContent = newTemp + '°C';
        }
    }, 30000); // Atualiza a cada 30 segundos
});
</script>
{% endblock %}

{% block scripts %}
<script nonce="{{ g.csp_nonce if g.csp_nonce else 'default' }}">
// Funcionalidades específicas do dashboard português
console.log('🇵🇹 Dashboard AgroTech Portugal carregado');
</script>
{% endblock %}

